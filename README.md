# RAG: Фильтрация и QA-поиск по судебной практике Т-банка (SudAct)

Проект по созданию RAG-системы для ответов на вопросы по базе судебных решений. Основной фокус — работа с «грязными» юридическими данными и фильтрация шума.

### Сложность:
Если просто искать на SudAct по запросу «Т-Банк», вылетает более 500 документов, где банк упоминается лишь как оператор. Для качественного RAG это мусор. Я реализовал пайплайн, который не просто ищет текст, а понимает роль банка в деле.


## Стек

* **Parser:** Selenium + Webdriver Manager. Реализован парсинг структуры документа (заголовок, URL, текст).
* **LLM Preprocessing:** `Qwen2.5-7B-Instruct` в квантовании `4-bit` (bitsandbytes). Используется для бинарной классификации: является ли банк активным участником спора.
* **Embeddings:** `deepvk/USER-bge-m3`.
* **Retrieval:** Гибридный поиск (`EnsembleRetriever`). Смешиваем `FAISS` (семантика) и `BM25` (ключевые слова).
* **Reranker:** `BAAI/bge-reranker-v2-m3` для финальной сортировки контекста перед подачей в модель.
* **Evaluation:** Фреймворк `Ragas` для оценки качества ответов.


## Архитектура решения

1.  **Парсинг:** Сбор 500 документов с SudAct.
2.  **Фильтрация:**
      * *Classic:* Regex-фильтр на уголовные дела.
      * *Neural:* Прогон через Qwen2.5 с жестким системным промптом для выявления роли банка.
3.  **Индексация:** Рекурсивный чанкинг (`chunk_size=1000`, `overlap=300`) и создание векторного хранилища.
4.  **RAG-пайплайн:** 1) Юзер задает вопрос 2) Гибридный поиск 3) Реранкинг 4) Генерация ответа через локальную LLM.
5.  **Оценка:** Замер метрик через `Ragas`.

---

## Результаты и метрики (Ragas)

Для оценки использовался `Qwen2.5-72B` через HuggingFace Endpoint. 

| Метрика | Результат | Комментарий |
| :--- | :--- | :--- |
| **Faithfulness** | **0.875** | Модель крайне редко «галлюцинирует» и опирается на факты |
| **Answer Relevancy** | **0.905** | Ответы попадают точно в запрос пользователя |
| **Context Precision** | **0.685** | Релевантные чанки поднимаются высоко |
| **Context Recall** | **0.625** | Иногда не хватает полноты данных из-за специфики юридических текстов |

> **Примечание:** В текущей версии ноутбука вывод ячеек с расчетом метрик в конце отсутствует, так как при финальном прогоне закончились лимиты на HF API. Все итоговые данные зафиксированы в `ragas_final_results.csv`.


## Структура файлов
* `parser.py` — парсер на Selenium.
* `SudAct_RAG_Full.ipynb` — основной ноутбук с препроцессингом, базой данных и инференсом.
* `sudact_dataset0_500.json` — сырые данные.
* `eval_data_with_retriever.csv` — сформированный датасет для оценки качества.


## Как запустить
1. Собрать данные: `python parser.py` (требуется установка Chrome).
2. Установить зависимости: `pip install -r requirements.txt`.
3. Запустить ноутбук, предварительно добавив `HF_TOKEN`.
